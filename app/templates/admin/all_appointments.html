{% extends "base.html" %}

{% block content %}
<div class="mb-6 flex items-center gap-4">
    <a href="{{ url_for('admin.list_users') }}" 
       class="group flex items-center gap-2 text-slate-400 hover:text-indigo-600 transition-colors">
        <div class="w-8 h-8 rounded-full bg-slate-100 group-hover:bg-indigo-100 flex items-center justify-center transition-all">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
        </div>
        <span class="text-[10px] font-black uppercase tracking-widest">Voltar para Usuários</span>
    </a>
</div>

{% if filter_user %}
    <div class="bg-indigo-50 border-l-4 border-indigo-500 p-5 mb-8 rounded-r-2xl shadow-sm">
        <p class="text-indigo-700 text-sm font-bold flex items-center gap-3">
            <span class="w-2 h-2 bg-indigo-500 rounded-full animate-pulse"></span>
            Exibindo histórico de: <span class="uppercase font-black tracking-tight text-indigo-900">{{ filter_user.name or filter_user.username }}</span>
        </p>
    </div>
{% endif %}

<div class="max-w-7xl mx-auto space-y-8">
    <div>
        <span class="text-[10px] font-black text-indigo-500 uppercase tracking-[0.3em] mb-2 block">Administração</span>
        <h1 class="text-4xl font-black text-slate-900 tracking-tight italic">
            {% if filter_user %}
                Histórico <span class="text-indigo-600 font-medium">Individual</span>
            {% else %}
                Agenda <span class="text-indigo-600">Global</span>
            {% endif %}
        </h1>
    </div>

    <div class="bg-white rounded-[2.5rem] shadow-xl border border-slate-100 overflow-hidden">
        <table class="w-full text-left border-collapse">
            <thead>
                <tr class="bg-slate-50/50 border-b border-slate-100">
                    {% if not filter_user %}
                        <th class="px-8 py-6 text-[10px] font-black text-slate-400 uppercase tracking-widest">Cliente</th>
                    {% endif %}
                    <th class="px-8 py-6 text-[10px] font-black text-slate-400 uppercase tracking-widest">Serviço</th>
                    <th class="px-8 py-6 text-[10px] font-black text-slate-400 uppercase tracking-widest">Data/Hora</th>
                    <th class="px-8 py-6 text-[10px] font-black text-slate-400 uppercase tracking-widest text-right">Ações</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-slate-50">
                {% for appt in appointments %}
                <tr class="hover:bg-slate-50/80 transition-all group">
                    {% if not filter_user %}
                        <td class="px-8 py-6 font-bold text-slate-900 capitalize">
                            {{ appt.user.name if appt.user.name else appt.user.username if appt.user else "Removido" }}
                        </td>
                    {% endif %}
                    
                    <td class="px-8 py-6">
                        <div class="flex items-center gap-3">
                            <div class="w-2 h-2 bg-indigo-400 rounded-full opacity-0 group-hover:opacity-100 transition-opacity"></div>
                            <span class="text-sm text-slate-700 font-bold capitalize">{{ appt.service.name }}</span>
                        </div>
                    </td>
                    
                    <td class="px-8 py-6 text-sm text-slate-500 font-medium">
                        {{ appt.start_datetime.strftime('%d/%m/%Y • %H:%M') }}
                    </td>
                    
                    <td class="px-8 py-6 text-right">
                        <form action="{{ url_for('admin.delete_appointment', id=appt.id) }}" method="POST" onsubmit="return confirm('Remover este registro permanentemente?')">
                            {% if csrf_token %}<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">{% endif %}
                            <button type="submit" class="px-4 py-2 bg-red-50 text-red-500 rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-red-500 hover:text-white transition-all border border-red-100">
                                Excluir
                            </button>
                        </form>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="4" class="px-8 py-20 text-center">
                        <p class="text-slate-400 text-[10px] font-black uppercase tracking-widest italic">Nenhum agendamento encontrado.</p>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}